<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievement viewer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Achievement viewer</h1>
        </header>

        <div id="info" class="info" style="display: none;">
            <h3>üìÅ Folder Structure:</h3>
        <p>Place each game's achievement file (<code>achievements.json</code> or <code>&lt;game-appid&gt;.db</code>)</p>
        <p>in the respective AppId folder at <code>AppID/&lt;game-appid&gt;/</code> on the <code>user</code> branch</p>
            <p style="margin-top: 10px;">The page will automatically scan all folders in the AppID directory!</p>
        </div>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <div>Scanning AppID folders...</div>
        </div>

        <div id="summary" style="display: none;"></div>

        <div id="search-container" class="search-container" style="display: none;">
            <div class="search-wrapper">
                <select id="search-type" onchange="window.setSearchType(this.value)">
                    <option value="name">Game Name</option>
                    <option value="appid">Steam AppID</option>
                    <option value="platform">Platform</option>
                    <option value="achievement">Achievement Info</option>
                </select>
                <input type="text" id="game-search" placeholder="Search..." oninput="window.setSearchTerm(this.value)">
            </div>
        </div>

        <div id="results"></div>
        <div id="detail-view" class="game-detail-view"></div>
    </div>

    <script type="module">
        import { init } from './js/GameLoader.js';
        import { 
            displayGames, 
            showGameDetail,
            renderGameDetail,
            hideGameDetail, 
            setSortMode, 
            setGridSortMode,
            handleDeepLink 
        } from './js/GameRenderer.js';
        
        window.showGameDetail = showGameDetail;
        window.renderGameDetail = renderGameDetail;
        window.hideGameDetail = hideGameDetail;
        window.setSortMode = setSortMode;
        window.setGridSortMode = setGridSortMode;
        
        init().then(() => {
            displayGames();
            handleDeepLink();
        });

        window.addEventListener('popstate', () => {
            const params = new URLSearchParams(window.location.search);
            const appId = params.get('game');
            if (appId) {
                showGameDetail(appId, false);
            } else {
                const dv = document.getElementById('detail-view');
                const gg = document.getElementById('games-grid');
                const sb = document.getElementById('summary-box');
                const gc = document.getElementById('grid-sort-controls');

                if (dv) dv.classList.remove('active');
                if (gg) gg.classList.remove('hidden');
                if (sb) sb.classList.remove('hidden');
                if (gc) gc.classList.remove('hidden');
            }
        });
    </script>
  </body>
</html>
